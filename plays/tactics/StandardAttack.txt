Metadata:
type tactic
name StandardAttack

Parameters:
attacker Robot
supporter Robot
closestenemy Robot

Objects:

# Local Constants
REGION_RADIUS (double 1)
VICINITY (double 0.3)
RANGE (double 2)
PI (double 3.1415)

ourTopCorner (point -3.05 2.1)
ourBottomCorner (point -3.05 -2.1)
theirBottomCorner (point 3.05 -2.1)
theirTopCorner (point 3.05 2.1)

goaltop (point 3.025 -0.33)
goalbottom (point 3.025 0.33)

CLEAR_DIST (const-double CLEAR_DIST)

# Regions
regionpoint1 (point 2.4 -0.6)
regionpoint2 (point 2.4 0)
regionpoint3 (point 2.4 0.6)

# Ball and robots
ballpoint (pointof ball)
attackerpoint (pointof attacker)
supporterpoint (pointof supporter)
#attackerpoint (point 1.2 1.3)
#supporterpoint regionpoint2

# BALL 
ballinrange (< (pointpointdistance ballpoint (theirgoal)) RANGE)
ballvelocity (velocityof ball)
balldirection (getAngle ballvelocity)
ballprojline (linedirection ballpoint balldirection)
ballprojpoint (linetopoint ballprojline 0.5)
ballpositive (< 0 (getYcoord ballpoint))
ballnegative (> 0 (getYcoord ballpoint))




# SUPPORTER 

# Geometry
supportercircle (circle supporterpoint VICINITY)
passdistance (pointpointdistance ballpoint supporterpoint)
passangle (angleBetweenTwoLines ballprojline (line ballpoint supporterpoint)) 
projpassdestpoint (linetopoint ballprojline passdistance)
passdiffvector (pointsubtract projpassdestpoint supporterpoint)
passdiffline (line projpassdestpoint supporterpoint)
passdiffdistance (pointpointdistance projpassdestpoint supporterpoint)

# Booleans
supporterinregion1 (inRegion supporterpoint regionpoint1 REGION_RADIUS) 
supporterinregion2 (inRegion supporterpoint regionpoint2 REGION_RADIUS) 
supporterinregion3 (inRegion supporterpoint regionpoint3 REGION_RADIUS) 

supporterinrange (< (pointpointdistance supporterpoint (theirGoalBestShot)) RANGE)

supportershotclear (pathClear supporterpoint (theirGoalBestShot) CLEAR_DIST)

supporterhasshot (and supporterinrange supportershotclear)

passclear (pathClear ballpoint supporterpoint CLEAR_DIST)

supporterwellpositioned (and supporterhasshot passclear) 

supporterfree (= 0 (numberOfRobotsInACircle supportercircle enemy))

ballpassed (< passdiffdistance CLEAR_DIST) 

shotongoal (bool false)

# Movement
gotoregion1 (robotpointpointmovenoavoid supporter regionpoint1 ballpoint)
gotoregion2 (robotpointpointmovenoavoid supporter regionpoint2 ballpoint)
gotoregion3 (robotpointpointmovenoavoid supporter regionpoint3 ballpoint)

# Actions
getinrange (if_Action (< (getYcoord ballpoint) 0) gotoregion1 gotoregion3)

changeregion (if_Action (inRegion supporterpoint regionpoint1 REGION_RADIUS) gotoregion2 (if_Action (inRegion supporterpoint regionpoint2 REGION_RADIUS) gotoregion3 gotoregion1))

waitforpass (donothing supporter)

meetpass (robotpointpointmovenoavoid supporter ballpoint ballpoint) 

# TODO getoutofway
getoutofwaypoint (if_point (< (getYcoord supporterpoint) 0) theirBottomCorner theirTopCorner)
getoutofway (robotpointpointmovenoavoid supporter getoutofwaypoint ballpoint)

# TODO improveshootangle
reachedMaxYPosThreshold (> (getYcoord supporterpoint) 0.7)
reachedMaxYNegThreshold (< (getYcoord supporterpoint) -0.7)

improveshootanglepoint (if_point (and ballpositive reachedMaxYNegThreshold)  (point (getXcoord supporterpoint) (+ (getYcoord supporterpoint) 0.5))  (if_point (and ballpositive (not reachedMaxYNegThreshold))  (point (getXcoord supporterpoint) (- (getYcoord supporterpoint) 0.5))
(if_point (and ballnegative reachedMaxYPosThreshold)  (point (getXcoord supporterpoint) (- (getYcoord supporterpoint) 0.5))  (point (getXcoord supporterpoint) (+ (getYcoord supporterpoint) 0.5)))))

#improveshootanglepoint (if_point ballpositive (point (getXcoord supporterpoint) (- (getYcoord supporterpoint) 0.5)) (point (getXcoord supporterpoint) (+ (getYcoord supporterpoint) 0.5)))
 
improveshootangle (robotpointpointmove supporter improveshootanglepoint ballpoint)

# TODO improvepassangle 
improvepassanglepoint (if_point ballpositive (point (getXcoord supporterpoint) (- (getYcoord supporterpoint) 0.5)) (point (getXcoord supporterpoint) (+ (getYcoord supporterpoint) 0.5)))

improvepassangle (robotpointpointmove supporter improveshootanglepoint ballpoint)

# Decision tree
#support 
#(if_Action supporterinrange 
#	(if_Action ballpassed
#		(if_Action shotongoal
#			getoutofway
#			meetpass)
#		(if_Action supporterfree
#			(if_Action clearpass
#				(if_Action clearshot
#					waitforpass
#					improveshootangle)
#				improvepassangle)
#			changeregion))
#	getinrange)

support (if_Action supporterinrange (if_Action ballpassed (if_Action shotongoal getoutofway meetpass) (if_Action supporterfree (if_Action passclear (if_Action supportershotclear waitforpass improveshootangle) improvepassangle) changeregion)) getinrange)

# ATTACKER 
# Geometry

attackercircle (circle attackerpoint VICINITY)

dribbleuppoint (point (+ (getXcoord attackerpoint) VICINITY) (+ (getYcoord attackerpoint) 0))

closestenemypoint (pointof closestenemy)

enemyattackercircleintersect (linecircleintersection (line attackerpoint closestenemypoint) attackercircle 1)

dribbleawaypoint (rotatePointAroundAnotherPoint attackerpoint enemyattackercircleintersect PI)


# booleans
attackerhasshot (and ballinrange (pathClear ballpoint (theirGoalBestShot) CLEAR_DIST))

attackerfree (= 0 (numberOfRobotsInACircle attackercircle enemy))



# Actions
shootTarget  (if_point (pathClear attackerpoint goaltop CLEAR_DIST) goaltop (if_point (pathClear attackerpoint goalbottom CLEAR_DIST) goalbottom (theirGoalBestShot)))
shoot (robotpointkick attacker shootTarget) 

pass (robotpointkick attacker supporterpoint)
dribbleup (robotpointbump attacker dribbleuppoint)
dribbleaway (robotpointbump attacker dribbleawaypoint)

# Decision tree
#attack 
#(if_Action attackerhasshot 
#	shoot
#	(if_Action (and passclear supporterhasshot)
#		pass
#		(if_Action attackerfree
#			dribbleup
#			(if_Action passclear
#				pass
#				dribbleaway))))


attack (if_Action attackerhasshot shoot (if_Action (and passclear supporterhasshot) pass (if_Action attackerfree dribbleup (if_Action passclear pass dribbleaway))))

Actions:
attack
support